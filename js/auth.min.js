const $=e=>document.getElementById(e),cookie=(e,a)=>{const n=document.cookie.split(";").map(e=>e.trim().split("=")).find(([a,n])=>a===e);return n?n[1]:a},setLanguage=async()=>{let e=await fetch("/api/language"),a=await e.json();if(a.status)return JSON.parse(a.data);alert("Internal Error, please try again later")},getAuthStatus=e=>"true"==e,country=cookie("country",null),COUNTRIES={AF:"Afghanistan",AX:"Åland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo, Republic of the (Brazzaville)",CD:"Congo, the Democratic Republic of the (Kinshasa)",CK:"Cook Islands",CR:"Costa Rica",CI:"Côte d'Ivoire, Republic of",HR:"Croatia",CU:"Cuba",CW:"Curaçao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Islas Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern and Antarctic Lands",GA:"Gabon",GM:"Gambia, The",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Laos",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Réunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthélemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"},COUNTRIES_EU=["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"];let I,typingTimer,rememberMe=cookie("should_remember",null),env="web",currentModalId=null,currentCardId=null,previousDialogId=null,resendCodeTimeouts=null,registerData={};const closeModal=e=>{$(`${e}-modal`).remove(),currentModalId=null},closeCard=e=>{$(`${e}-card`).remove(),currentModalId=null},submitForm=(e,a)=>{switch(a.preventDefault(),e){case"login":submitLogin();break;case"register":submitRegister();break;case"forgot":submitRequestReset();break;case"terms":submitTerms();break;case"verification":submitVerification();break;case"reset":submitResetPassword();break;case"change-password":submitChangePassword();break;case"change-email":submitChangeEmail();break;case"verify-new-email":submitNewEmailVerify()}},postData=async(e="",a={},n="POST")=>{try{const i=await fetch(e,{method:n,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return await i.json()}catch(e){return console.log(e),!1}},getAgreements=async()=>{try{const e=await fetch("/api/agreement/");return await e.text()}catch(e){return console.log(e),!1}};async function card(e){let a;switch(void 0===I&&(I=await setLanguage()),currentCardId&&closeCard(currentCardId),e){case"login":a=`\n                <h2 class="text-center">Login</h2>\n                <p class="text-center" style="padding-top: 5px;">Not a member? <span onclick="card('register')">Sign up now!</span></p>\n\n                ${await loginFormContent()}\n            `;break;case"register":a=`\n                <h2 class="text-center">Sign Up</h2>\n                <p class="text-center" style="padding-top: 5px;">Already a member? <span onclick="card('login')">Login now!</span></p>\n\n                ${registerFormContent()}\n            `;break;case"forgot":a=`\n                <h2 class="text-center">${I.forgottenPass}</h2>\n                <p class="text-center" style="padding-top: 5px">${I.resetPassDesc}</p>\n\n                ${forgotPasswordForm()}\n\n                <a class="top-35 text-center" onclick="card('login')">&#8592; ${I.back}</a>\n            `;break;case"terms":a=`\n                <h2 class="bot-30">${I.terms}</h2>\n\n                ${await agreementsFormContent()}\n            `;break;case"reset":a=`                \n                <h2>${I.resetPass}</h2>\n\n                ${passwordResetFormContent()}\n                \n                <p class="top-35"><a class="link green" id="back-forgot" onclick="card('forgot')">&#8592; ${I.back}</a></p>\n            `;break;case"verification":a=`\n                    <h2>${I.verifyAcc}</h2>\n                    <p class="top-20" id="toEmail" data-text="${I.sentCodeDesc}">${I.sentCodeDesc}</p>\n\n                    ${verificationFormContent()}\n\n                    <p class="top-35"><a class="link green" onclick="openPreviousCard()">&#8592; ${I.back}</a></p>\n            `;break;case"verify-new-email":a=`\n                <h2>${I.verifyAcc}</h2>\n                <p class="top-20" id="toEmail" data-text="${I.sentCodeDesc}">${I.sentCodeDesc}</p>\n\n                ${verificationFormContent("new-email")}\n\n                <p class="top-35"><a class="link green" onclick="openPreviousModal()">&#8592; ${I.back}</a></p>\n            `}currentCardId=e;const n=document.createElement("section");return n.id=`${e}-card`,n.classList.add("auth-card"),n.style.display="flex",n.innerHTML=a,document.body.appendChild(n)}const modal=async(e,a=!1)=>{void 0===I&&(I=await setLanguage()),currentModalId&&closeModal(currentModalId);let n=`\n        <div class="sm-modal align-center animate-top">\n            <div class="modal-header">\n                <img src="${CDN_URL}/images/modal/modal-header.jpg" alt="modal-header"/>\n                <span class="close-modal" onclick="closeModal('${e}')">&times;</span>\n            </div>\n    `;switch(e){case"login":n+=`\n                <div class="modal-body">\n                    <h4>${I.login}</h4>\n\n                    ${await loginFormContent(a)}\n\n                    <p class="top-60 center">${I.notMember} <a class="link green" id="sign-up" onclick="modal('register')">${I.signUpNow} </a></p>\n                </div>\n            `;break;case"register":n+=`\n                <div class="modal-body">\n                    <h4>${I.signUp}</h4>\n\n                    ${registerFormContent()}\n\n                    <p class="top-60 center">${I.alreadyMember} <a class="link green" id="login-link" onclick="modal('login')">${I.loginHere}</a></p>\n                </div>\n            `;break;case"verification":n+=`\n                <div class="modal-body">\n                    <h4>${I.verifyAcc}</h4>\n                    <p class="top-20 text-left" id="toEmail" data-text="${I.sentCodeDesc}">${I.sentCodeDesc}</p>\n\n                    ${verificationFormContent()}\n\n                    <p class="top-60"><a class="link green" onclick="openPreviousModal()">&#8592; ${I.back}</a></p>\n                </div>\n\n            `;break;case"forgot":n+=`\n                <div class="modal-body">\n                    <h4>${I.forgottenPass}</h4>\n                    <p class="top-20 text-left">${I.resetPassDesc}</p>\n\n                    ${forgotPasswordForm()}\n\n                    <div class="top-60 center">\n                        <a class="link green" id="back-login" onclick="modal('login')">&#8592; ${I.back}</a>\n                    </div>\n                </div>\n            `;break;case"reset":n+=`\n                <div class="modal-body">\n                    <h4>${I.resetPass}</h4>\n\n                    ${passwordResetFormContent()}\n                    \n                    <p class="top-60"><a class="link green" id="back-forgot" onclick="modal('forgot')">&#8592; ${I.back}</a></p>\n                </div>\n            `;break;case"terms":n=`\n                <div class="lg-modal align-center animate-top">\n                    <div class="modal-header">\n                        <img src="${CDN_URL}/images/modal/tc-modal-header.jpg" alt="modal header" />\n                        <span class="close-modal" onclick="closeModal('${e}')">&times;</span>\n                    </div>\n                    <div class="modal-body">\n                        <h4 class="bot-30">${I.terms}</h4>\n                        ${await agreementsFormContent()}\n                    </div>\n            `;break;case"verify-new-email":n+=`\n                <div class="modal-body bot-30">\n                    <h4>${I.verifyAcc}</h4>\n                    <p class="top-20 text-left" id="toEmail" data-text="${I.sentCodeDesc}">${I.sentCodeDesc}</p>\n\n                    ${verificationFormContent("new-email")}\n\n                    <p class="top-60"><a class="link green" onclick="openPreviousModal()">&#8592; ${I.back}</a></p>\n                </div>\n            `;break;case"change-password":n+=changePasswordModalContent();break;case"change-email":n+=changeEmailModalContent()}currentModalId=e;const i=document.createElement("div");return i.id=`${e}-modal`,i.classList.add("auth-modal"),i.style.display="flex",i.innerHTML=n,document.body.appendChild(i)};async function loginFormContent(e=!1){if(null!==rememberMe){let{email:e}=await postData("/auth/rememberMe/",{rememberMe:rememberMe});e&&(rememberMe=e)}return`\n        <form id="login-form" onsubmit="submitForm('login', event)">\n\n            ${e?`\n                <input type="hidden" name="callback" value="${encodeURIComponent(e)}" >\n            `:""}\n\n            <div class="input-row">\n                <label for="login-email">${I.email}</label>\n                <input type="email" id="login-email" name="email" value="${rememberMe||""}" onkeyup="validateEmailTimer(event)" onblur="validateEmail(event)" />\n                <p class="error-msg">${I.pixlrLogin_EnterValidEmail}</p>\n            </div>\n            <div class="input-row">\n                <label for="login-password">${I.password}</label>\n                <input type="password" id="login-password" name="password" onkeyup="validatePasswordTimer(event)" />\n                <p class="error-msg"></p>\n                <img class="eye img-inline" src="${CDN_URL}/img/icon/eye-hide.svg" onclick="showPassword(event)">\n            </div>\n            <div class="input-row">\n                <button type="submit" id="login-btn">${I.login}</button>\n            </div>\n            <div class="input-col space-between">\n                <div>\n                    <input type="checkbox" id="login-rememberMe" name="rememberMe" ${rememberMe?"checked":""} />\n                    <label for="login-rememberMe" class="text-initial custom-checkbox">${I.rememberMe}</label>\n                </div>\n                <div>\n                    <a onclick="showDialog('forgot')">${I.forgotPass}</a>\n                </div>\n            </div>\n\n        </form>\n    `}function registerFormContent(){let e;for(let a in COUNTRIES)e+=null!==country&&country===a||null===country&&"US"===a?`<option value="${a}" selected>${COUNTRIES[a]}</option>`:`<option value="${a}">${COUNTRIES[a]}</option>`;return`\n        <form name="register-form" onsubmit="submitForm('register', event)">\n\n            <div class="input-row">\n                <label for="register-email">${I.email}</label>\n                <input type="email" id="register-email" name="email" onkeyup="validateEmailTimer(event)" onblur="validateEmail(event)"/>\n                <p class="error-msg">${I.pixlrLogin_EnterValidEmail}</p>\n            </div>\n            <div class="input-row">\n                <label for="register-password">${I.password}</label>\n                <input type="password" id="register-password" name="password" onkeyup="validatePasswordTimer(event)" />\n                <p class="error-msg"></p>\n                <img class="eye img-inline" src="${CDN_URL}/img/icon/eye-hide.svg" onclick="showPassword(event)">\n            </div>\n            <div class="input-row">\n                <label for="register-country" class="form-label upper">${I.country}</label>\n                <select id="register-country" name="country">\n                    ${e}\n                </select>\n            </div>\n            <div class="input-row">\n                <button type="submit" id="register-btn">${I.signUp}</button>\n            </div>\n            \n        </form>\n    `}function forgotPasswordForm(){return`\n        <form name="forgot-password-form" onsubmit="submitForm('forgot', event)" class="top-35">\n            <div class="input-row">\n                <label for="forgot-email">${I.email}</label>\n                <input type="email" id="forgot-email" name="email" onkeyup="validateEmailTimer(event)" onblur="validateEmail(event)" />\n                <p class="error-msg">${I.pixlrLogin_EnterValidEmail}</p>\n            </div>\n            <div class="input-row">\n                <button type="submit">${I.reqCode}</button>\n            </div>\n        </form>\n    `}function verificationFormContent(e=""){return"new-email"===e?`\n        <form name="verification-code-form" onsubmit="submitForm('verify-new-email', event)">\n            <input id="change-verification-email" type="hidden" name="email">\n            <div class="input-row">\n                <label for="change-code">${I.code}</label>\n                <input type="number" id="change-code" name="change-code" onkeypress="if(this.value.length===6)return false;" onkeyup="validateVerificationCodeTimer(event)"/>\n                <p class="error-msg">${I.pixlrLogin_EnterValidCode}</p>\n            </div>\n            <div class="input-row">\n                <button type="submit">${I.verify}</button>\n            </div>\n            <p class="top-20 hide" id="change-email-resend">${I.didNotReceiveCode} <a class="link green" onclick="resendCode('change-email')">${I.resend}</a></p>\n        </form>\n    `:`\n        <form name="verification-code-form" onsubmit="submitForm('verification', event)">\n            <input id="verification-email" type="hidden" name="email">\n            <div class="input-row">\n                <label for="verify-code" class="form-label upper">${I.code}</label>\n                <input type="number" name="code" id="verify-code" onkeypress="if(this.value.length===6)return false;" onkeyup="validateVerificationCodeTimer(event)"/>\n                <p class="error-msg">${I.pixlrLogin_EnterValidCode}</p>\n            </div>\n            <div class="input-row">\n                <button type="submit">${I.verify}</button>\n            </div>\n            <p class="top-20 hide" id="verification-code-resend">${I.didNotReceiveCode} <a class="link green" onclick="resendCode('register-code')">${I.resend}</a></p>\n        </form>\n    `}function passwordResetFormContent(){return`\n        <form name="password-reset-form" onsubmit="submitForm('reset', event)">\n            <div class="input-row">\n                <label for="reset-email" class="form-label upper">${I.email}</label>\n                <input id="reset-email" type="email" name="email" readonly/>\n                <p class="error-msg">${I.pixlrLogin_EnterValidEmail}</p>\n            </div>\n            <div class="input-row">\n                <label for="reset-password" class="form-label upper">${I.newPass}</label>\n                <input type="password" id="reset-password" name="password" onkeyup="validatePasswordTimer(event)" />\n                <p class="error-msg"></p>\n                <img class="eye img-inline" src="${CDN_URL}/img/icon/eye-hide.svg" onclick="showPassword(event)">\n            </div>\n            <div class="input-row">\n                <label for="reset-code" class="form-label upper">${I.code}</label>\n                <input type="number" id="reset-code" name="code" onkeypress="if (this.value.length === 6) return false;" onkeyup="validateVerificationCodeTimer(event)"/>\n                <p class="error-msg">${I.pixlrLogin_EnterValidCode}</p>\n            </div>\n            <div class="input-row">\n                <button type="submit" class="top-20">${I.updatePass}</button>\n            </div>\n            <p class="top-20 hide" id="reset-resend">${I.didNotReceiveCode} <a class="link green" onclick="resendCode('reset')">${I.resend}</a></p>\n        </form>\n    `}function changePasswordModalContent(){return`\n    <div class="modal-body">\n        <h4>${I.changePassword}</h4>\n        <form name="change-password-form" class="top-35" onsubmit="submitForm('change-password', event)">\n            <div class="input-row">\n                <label for="change-old-password" class="form-label upper">${I.oldPass}</label>\n                <input type="password" name="oldpassword" id="change-old-password" required/>\n                <p class="error-msg"></p>\n                <img class="eye img-inline" src="${CDN_URL}/img/icon/eye-hide.svg" onclick="showPassword(event)">\n            </div>\n            <div class="input-row">\n                <label for="password" class="form-label upper">${I.newPass}</label>\n                <input type="password" name="password" id="change-new-password" onkeyup="validatePasswordTimer(event)" required/>\n                <p class="error-msg"></p>\n                <img class="eye img-inline" src="${CDN_URL}/img/icon/eye-hide.svg" onclick="showPassword(event)">\n            </div>\n            <div class="input-row">\n                <button type="submit" class="top-20">${I.changePassword}</button>\n            </div>\n        </form>\n    </div>\n    `}function changeEmailModalContent(){return`\n    <div class="modal-body">\n        <h4>${I.changeEmail}</h4>\n        <form name="change-email-form" class="top-35" onsubmit="submitForm('change-email', event)">\n            <div class="input-row">\n                <label for="change-email" class="form-label upper">${I.newEmail}</label>\n                <input type="email" name="email" id="change-email" onkeyup="validateEmailTimer(event)" onblur="validateEmail(event)"/>\n                <p class="error-msg">${I.pixlrLogin_EnterValidEmail}</p>\n            </div>\n            <div class="input-row">\n                <button type="submit" class="top-20">${I.changeEmail}</button>\n            </div>\n        </form>\n    </div>\n    `}async function agreementsFormContent(){return`\n        <div class="agreements-wrapper">${await getAgreements()}</div>\n        <form name="agreements-form" onsubmit="submitForm('terms', event)">\n            <div class="input-row">\n                <input type="checkbox" id="newsletter" name="newsletter" checked/>\n                <label for="newsletter" class="text-initial custom-checkbox">${I.regNewsletter}</label>\n            </div>\n            <div class="input-row">\n                <input type="checkbox" id="recommendations" name="recommendations" />\n                <label for="recommendations" class="text-initial custom-checkbox">${I.regRecommendations}</label>\n            </div>\n            <div class="input-row hide">\n                <input type="checkbox" id="above16" name="above16" onchange="verifyCheckbox(event)"/>\n                <label for="above16" class="text-initial custom-checkbox" >${I.above16}</label>\n            </div>\n            <div class="input-row hide">\n                <input type="checkbox" id="readAgreements" name="readAgreements" onchange="verifyCheckbox(event)"/>\n                <label for="readAgreements" class="text-initial custom-checkbox">${I.readAgreements}</label>\n            </div>\n            <div class="input-col justify-center">\n                <input id="refuseTerms" class="button gray rect-x20 right-15" type="submit" value="${I.refuse}" name="refuse" onclick="this.setAttribute('clicked',true)"/>\n                <input id="agreeTerms" class="button green rect-x20" type="submit" value="${I.agree}" name="agree" onclick="this.setAttribute('clicked',true)"/>\n            </div>\n        </form>\n    `}const getFormInput=e=>{const a={};return Array.from(document.forms[e].getElementsByTagName("input")).map(e=>{"checkbox"==e.type?a[e.name]=e.checked:a[e.name]=e.value}),Array.from(document.forms[e].getElementsByTagName("select")).map(e=>{a[e.name]=e.value}),a},submitLogin=()=>{const e=validateEmail($("login-email"),!0),a=validatePassword($("login-password"),!0);if(!e||!a)return!1;const n=getFormInput("login-form"),i=document.createElement("img");i.src="",i.alt="loading",i.style.width="20px",i.style.marginTop="7px",$("login-btn").innerHTML=`\n        <img src="${CDN_URL}/images/myaccount/loading.gif" alt="loading" style="width:20px;">\n    `,postData("/auth/login",n).then(e=>{if("desktop"==env&&e.status&&e.accessToken&&e.refreshToken)return $("login-btn").innerHTML=`<img src="${CDN_URL}/images/license/green_tick.svg" class="checkmark" alt="green tick icon">`,window.location.href="/login/desktop-success";if($("login-btn").innerText="Login",e.status){const a=new URLSearchParams(window.location.search);if(a.has("redirectUri")&&a.has("upgrade"))return window.history.pushState("object or string",null,"/"),window.location.href="/myaccount/?tab=subscription&upgrade=yearly";if(e.redirectUrl.includes("checkout"))return window.location.href=decodeURIComponent(e.redirectUrl);window.location.reload()}else if(e.verify){previousDialogId="login",showDialog("verification"),showToast("danger",e.message,5);let a=$("toEmail").dataset.text.replace("[EMAIL]",e.email);$("toEmail").innerHTML=a,$("verification-email").value=e.email,resendCodeTimeouts=setTimeout(()=>{$("verification-code-resend").style.display="block"},3e4)}else showToast("danger",e.message,5)})},submitRegister=async()=>{const e=validateEmail($("register-email"),!0),a=validatePassword($("register-password"),!0);if(!e||!a)return!1;registerData=getFormInput("register-form"),await showDialog("terms"),"CA"===registerData.country?$("newsletter").checked=!1:$("newsletter").checked=!0,COUNTRIES_EU.some(e=>e===registerData.country)&&($("above16").parentElement.style.display="block",$("readAgreements").parentElement.style.display="block",$("recommendations").parentElement.classList.add("hide"),disableOrEnableAgreeButton("disable"))},submitRequestReset=()=>{if(!validateEmail($("forgot-email"),!0))return!1;const e=getFormInput("forgot-password-form");e.resend=!1,postData("/auth/request/code",e).then(a=>{if(!a.status)return showToast("danger",a.message,5);showToast("success",a.message,5),showDialog("reset"),$("reset-email").value=e.email,resendCodeTimeouts=setTimeout(()=>{$("reset-resend").style.display="block"},3e4)})},submitTerms=()=>{$("agreeTerms").getAttribute("clicked");if("true"==$("refuseTerms").getAttribute("clicked"))return $("refuseTerms").removeAttribute("clicked"),showDialog("register"),$("register-email").value=registerData.email,void($("register-password").value=registerData.password);registerData.newsletter=$("newsletter").checked,registerData.recommendations=$("recommendations").checked,$("agreeTerms").removeAttribute("clicked"),postData("/auth/register",registerData).then(e=>{if(!e.status)return showToast("danger",e.message,5),showDialog("register"),$("register-email").value=registerData.email,$("register-password").value=registerData.password,void($("register-country").value=registerData.country);previousDialogId="terms",showDialog("verification");let a=$("toEmail").dataset.text.replace("[EMAIL]",registerData.email);$("toEmail").innerHTML=a,$("verification-email").value=registerData.email,resendCodeTimeouts=setTimeout(()=>{$("verification-code-resend").style.display="block"},3e4)})},submitVerification=()=>{if(!validateVerificationCode($("verify-code"),!0))return!1;const e=getFormInput("verification-code-form");postData("/auth/verify",e).then(e=>e.status?(registerData={},showToast("success",e.message,5),"desktop"==env?window.location.href="/login/desktop-success":(closeModal(currentModalId),void setTimeout(()=>{window.location.reload()},1e3))):showToast("danger",e.message,5))},submitResetPassword=()=>{const e=validateEmail($("reset-email"),!0),a=validatePassword($("reset-password"),!0),n=validateVerificationCode($("reset-code"),!0);if(!e||!a||!n)return!1;const i=getFormInput("password-reset-form");postData("/auth/reset",i).then(e=>{if(!e.status)return showToast("danger",e.message,5);showDialog("login"),showToast("success",e.message,5)})},submitChangeEmail=()=>{if(!validateEmail($("change-email"),!0))return!1;const e=$("change-email").value;postData("/auth/changeemail/request/",{newEmail:e}).then(a=>{if(!a.status)return showToast("danger",a.message);previousDialogId="change-email",modal("verify-new-email");let n=$("toEmail").dataset.text.replace("[EMAIL]",e);$("toEmail").innerHTML=n,$("change-verification-email").value=e,showToast("success",a.message,5),resendCodeTimeouts=setTimeout(()=>{$("change-email-resend").style.display="block"},3e4)})},submitNewEmailVerify=()=>{if(!validateVerificationCode($("change-code"),!0))return;const e=$("change-code").value,a=$("change-verification-email").value;postData("/auth/changeemail/verify",{code:e,newEmail:a}).then(e=>{if(!e.status)return showToast("danger",e.message,5);showToast("success",e.message,5),closeModal(currentModalId),setTimeout(()=>{window.location.replace("/logout")},1e3)})},submitChangePassword=()=>{const e=$("change-old-password").value,a=$("change-new-password").value;postData("/auth/changepassword",{oldPassword:e,newPassword:a},"PUT").then(e=>{if(!e.status)return showToast("danger",e.message,5);showToast("success",e.message,5),setTimeout(()=>{window.location.replace("/logout")},2e3)})},verifyCheckbox=e=>{const a=e.target,n=document.getElementById("readAgreements"),i=document.getElementById("above16");return"above16"===a.id&&a.checked&&n.checked?disableOrEnableAgreeButton("enable"):"readAgreements"===a.id&&a.checked&&i.checked?disableOrEnableAgreeButton("enable"):void disableOrEnableAgreeButton("disable")},disableOrEnableAgreeButton=e=>{const a=$("agreeTerms");"enable"===e?(a.disabled=!1,a.classList.remove("disable"),a.classList.add("green")):(a.disabled=!0,a.classList.remove("green"),a.classList.add("disable"))},resendCode=e=>{let a,n;"register-code"===e?(a=$("verification-email").value,n=$("verification-code-resend")):"reset"===e?(a=$("reset-email").value,n=$("reset-resend")):"change-email"===e&&(a=$("change-verification-email").value,n=$("change-email-resend")),"change-email"===e?postData("/auth/changeemail/request/",{newEmail:a}).then(e=>{if(!e.status)return showToast("danger",e.message,5);showToast("success",e.message,5)}):postData("/auth/request/code/",{email:a,resend:!0}).then(e=>{if(!e.status)return showToast("danger",e.message,5);showToast("success",e.message,5)}),n.style.display="none",resendCodeTimeouts=setTimeout(()=>{n.style.display="block"},3e4)},openPreviousCard=()=>{card(previousDialogId),previousDialogId=null,clearTimeout(resendCodeTimeouts)},openPreviousModal=()=>{modal(previousDialogId),previousDialogId=null,clearTimeout(resendCodeTimeouts)},showPassword=e=>{const a=e.target.previousElementSibling.previousElementSibling;e.target.src.indexOf("warning")>-1||(e.target.src.indexOf("eye-hide")>-1?(e.target.src=`${CDN_URL}/img/icon/eye-show.svg`,a.type="text"):(e.target.src=`${CDN_URL}/img/icon/eye-hide.svg`,a.type="password"))},validateEmailTimer=e=>{clearTimeout(typingTimer),typingTimer=setTimeout(()=>validateEmail(e,!1),1e3)},validateEmail=(e,a=!1)=>{let n=a?e:e.target,i=!1;return n.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)?(n.classList.remove("invalid"),n.nextElementSibling.style.display="none","login-email"==n.id&&($("login-btn").disabled=i),"register-email"==n.id&&($("register-btn").disabled=i)):(i=!0,n.classList.add("invalid"),n.nextElementSibling.style.display="block","login-email"==n.id&&($("login-btn").disabled=i),"register-email"==n.id&&($("register-btn").disabled=i)),!i},validatePasswordTimer=e=>{clearTimeout(typingTimer),typingTimer=setTimeout(()=>validatePassword(e,!1),1e3)},validatePassword=(e,a=!1)=>{let n,i,t=!1;return a?(n=e,i=e.nextElementSibling,imgElement=i.nextElementSibling):(n=e.target,i=e.target.nextElementSibling,imgElement=i.nextElementSibling),"login-password"===n.id||n.value.match(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%&*?'"~_.\/+\-|()^`:;<>,])[A-Za-z\d!@#$%&*?'"~_.\/+\-|()^`:;<>,]{8,}$/)||(t=!0),n.value.length<8||n.value.length>50||t?(n.classList.add("invalid"),i.style.display="block",imgElement.style.display="none",n.value.length<8?i.innerHTML=I.pixlrLogin_MinPassword:t?i.innerHTML=I.pixlrLogin_EnterValidPassword:n.value.length>50&&(i.innerHTML=I.pixlrLogin_MaxPassword),t=!0):(t=!1,n.classList.remove("invalid"),i.style.display="none",imgElement.style.display="block",imgElement.src=`${CDN_URL}/img/icon/eye-hide.svg`),"login-password"==n.id&&(document.getElementById("login-btn").disabled=t),"register-password"==n.id&&(document.getElementById("register-btn").disabled=t),!t},validateVerificationCodeTimer=e=>{clearTimeout(typingTimer),typingTimer=setTimeout(()=>validateVerificationCode(e,!1),1e3)},validateVerificationCode=(e,a=!1)=>{let n=a?e:e.target,i=!1;return 6!==n.value.length?(n.classList.add("invalid"),i=!0):(i=!1,n.classList.remove("invalid")),!i},showDialog=async e=>{"desktop"==env?await card(e):await modal(e)},showToast=(e="danger",a,n=3)=>{const i=document.createElement("div");i.id="dialog-box",i.classList.add("alert",e),i.innerHTML=`\n        <span><img src="${CDN_URL}/images/icon/${e}_alert.png" /></span>\n        <span class="alert-text">${a}</span>\n        <span class="alert-close ${e}" onclick="this.parentElement.style.display = 'none'">&times;</span>\n    `,document.getElementsByTagName("body")[0].appendChild(i),setTimeout(()=>document.getElementById("dialog-box").remove(),1e3*n)};(async()=>{void 0===I&&(I=await setLanguage()),preLoad&&showDialog("login")})();